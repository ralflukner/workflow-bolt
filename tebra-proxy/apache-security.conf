# HIPAA/PHI Security Configuration for Apache

# Security Headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# HSTS (HTTP Strict Transport Security) - Force HTTPS
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

# Content Security Policy
Header always set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; frame-ancestors 'none';"

# Hide Apache version and OS info
ServerTokens Prod
ServerSignature Off

# Disable server-side includes and CGI execution
Options -Includes -ExecCGI -Indexes

# Prevent access to .htaccess and other sensitive files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Prevent access to backup and temporary files
<FilesMatch "\.(bak|backup|swp|tmp|~)$">
    Require all denied
</FilesMatch>

# Prevent access to PHP configuration files
<FilesMatch "\.php(\.ini|\.conf)$">
    Require all denied
</FilesMatch>

# Rate limiting and DoS protection
<IfModule mod_evasive24.c>
    DOSHashTableSize    2048
    DOSPageCount        20
    DOSPageInterval     1
    DOSSiteCount        100
    DOSSiteInterval     1
    DOSBlockingPeriod   300
</IfModule>

# Timeout settings
Timeout 30
KeepAliveTimeout 5

# Limit request size (prevent large uploads)
LimitRequestBody 1048576

# Log format for audit trails (HIPAA requirement)
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" %D" combined_with_time
CustomLog /var/log/apache2/access.log combined_with_time 